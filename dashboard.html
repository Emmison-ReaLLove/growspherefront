<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grow Sphere-User Dashboard</title>
  <link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicons/growsphere-1.png" />
     <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicons/growsphere-2.png" />
     <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicons/growsphere-3.png" />
     <link rel="icon" type="image/x-icon" href="/favicon.ico">
     <meta name="description" content="Maximize Your Earnings with a Trusted Platform Designed for Success" />	
        <link rel="stylesheet" href="assets/vendors/animate/animate.min.css" />
        <link rel="stylesheet" href="assets/vendors/animate/custom-animate.css" />
        <link rel="stylesheet" href="assets/vendors/bxslider/jquery.bxslider.css" />
        <link rel="stylesheet" href="assets/vendors/fontawesome/css/all.min.css" />
        <link rel="stylesheet" href="assets/vendors/jquery-magnific-popup/jquery.magnific-popup.css" />
        <link rel="stylesheet" href="assets/vendors/jquery-ui/jquery-ui.css" />
        <link rel="stylesheet" href="assets/vendors/nice-select/nice-select.css" />
        <link rel="stylesheet" href="assets/vendors/odometer/odometer.min.css" />
        <link rel="stylesheet" href="assets/vendors/owl-carousel/owl.carousel.min.css" />
        <link rel="stylesheet" href="assets/vendors/owl-carousel/owl.theme.default.min.css" />
        <link rel="stylesheet" href="assets/vendors/swiper/swiper.min.css" />
        <link rel="stylesheet" href="assets/vendors/vegas/vegas.min.css" />
        <link rel="stylesheet" href="assets/vendors/thm-icons/style.css">
        <link rel="stylesheet" href="assets/vendors/language-switcher/polyglot-language-switcher.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    
        <link rel="stylesheet" href="styles.css">
        <!-- Module css -->
        <link rel="stylesheet" href="assets/css/module-css/01-header-section.css">
        <link rel="stylesheet" href="assets/css/module-css/02-banner-section.css">
        <link rel="stylesheet" href="assets/css/module-css/03-about-section.css">
        <link rel="stylesheet" href="assets/css/module-css/04-fact-counter-section.css">
        <link rel="stylesheet" href="assets/css/module-css/05-testimonial-section.css">
        <link rel="stylesheet" href="assets/css/module-css/06-partner-section.css">
        <link rel="stylesheet" href="assets/css/module-css/07-footer-section.css">
        <link rel="stylesheet" href="assets/css/module-css/08-blog-section.css">
    
        <!-- Template styles -->
        <link rel="stylesheet" href="assets/css/style.css" />
        <link rel="stylesheet" href="assets/css/responsive.css" />
       <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" rel="stylesheet" />
    
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Menu</h2>
      <ul>
        <li style="padding-bottom: 10px;"><a href="/dashboard">Home 🏠</a></li>
        <li style="padding-bottom: 10px;"><a href="/profile">Profile 👤</a></li>
        <li style="padding-bottom: 10px;"><a href="/withdraw">Withdrawal 💳</a></li>
        <li style="padding-bottom: 10px;"><a href="/marketplace">Marketplace 🛒</a></li>
        <li style="padding-bottom: 10px;"><a href="/activity">Activity 📊</a></li>
        <li style="padding-bottom: 10px;"><a href="/logout">Logout 🚪</a></li>

      </ul>
    </div>
  
    <!-- Main Content -->
    <div class="main-content">
      <button id="toggle-btn"> ☰ </button>
      <div class= "dashboard-header">
        <div class="header-content">
          <div class="title-section" style="padding-left: 30px;">
            <h1>Dashboard</h1>
            <h2>Welcome back!, <span class="username">[User Name]</span></h2>
            <div>Active Now 🟢</div>
          </div>          
          <div class="user-actions">
            <button class="notification-btn" title="Notifications">
              🔔
            </button>
            <button class="profile-btn" title="Profile">
              👤
            </button>
          </div>
        </div>
      </div>
      <!-- Summary Cards -->
      <section class="dashboard-cards">
        <div class="card">
          <h3>Active Package</h3>
          <p id="active-package">--</p>
        </div>
        <div class="card">
          <h3>All-Time Earnings</h3>
          <p id="all-time-earnings">$0</p>
        </div>        
      </section>

      <!-- Earnings and Referrals -->
      <section class="dashboard-stats">
        <div class="stat">
          <h4>GSP Cash</h4>
          <p id="gsp-cash">$0</p>
        </div>
        <div class="stat red">
          <h4>Sale Commission</h4>
          <p id="sale-commission">$0</p>
        </div>
        <div class="stat">
          <h4>Today's Referrals</h4>
          <p id="todays-referrals">0</p>
        </div>
        <div class="stat">
          <h4>Total Referrals</h4>
          <p id="total-referrals">0</p>
        </div>
      </section>

      <!-- Referral Link -->
      <section class="referral">
        <h4>Referral Link</h4>
        <div class="referral-container">
          <input type="text" id="referral-link" readonly value="https://example.com/referral-code">
          <button id="copy-btn">Copy</button>
        </div>
      </section>
      <section>
        <div id="message-container" ></div>
      <div class="chart-container" style="position: relative; width: 70vw;">
        <canvas id="combinedChart"></canvas>
      </div>
      </section>      
<style>
  .chart-container {
  margin: 20px auto;
  padding: 10px;
  background:#f9f9f9 ;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

</style>     
  </div>
  </div>

  <section class="daily-tasks">
    <h2>💼 Daily Tasks</h2>
    <p class="instructions">
      Complete your daily task by clicking on the box below. Earn rewards every day and grow your GSP Cash!
    </p>
    <div class="task-container">
      <div> 
       <img src="prize.png" >
     </div>
      <div class="task" id="choose" data-index="1">
        <div class="inner">
          <div class="front" style="background-color: inherit;">
            <p>Click Me</p>
          </div>
          <div class="back"></div>
        </div>
      </div>
      <div> 
        <img src="award.png" >
      </div>
    </div>
    <button id="claim-btn" disabled>Claim Reward</button>
    <p id="task-message"></p>
  </section>
  <!-- Advertisement Section -->
  <section class="partner-area features-content">
    <div class="container">
        <div class="partner-area__sec-title">
            <h3 style="font-weight: bold;font-size: 40px;">Platform Features</h3>
        </div>
        <div class="brand-content">
            <div class="owl-carousel owl-theme thm-owl__carousel partner-carousel" data-owl-options='{
                "loop": true,
                "autoplay": true,
                "margin": 25,
                "nav": false,
                "dots": false,
                "smartSpeed": 500,
                "autoplayTimeout": 3000,
                "navText": ["<span class=\"fa fa-angle-left\"></span>","<span class=\"fa fa-angle-right\"></span>"],
                "responsive": {
                        "0": {
                            "items": 1
                        },
                        "768": {
                            "items": 2
                        },
                        "992": {
                            "items": 3
                        },
                        "1200": {
                            "items": 4
                        }
                    }
                }'>

                <!--Start Single Partner Logo Box-->
                <div class="single-partner-logo-box" style="min-height: 250px; width: 250px; text-align: center;">
                    <a href="#"><img src="assets/images/brand/brand-1-1.jpg" style="height: 200px; width: 200px" alt="Social Media Monetization"></a>
                    <h3 style="font-weight: bold;">Social Media Monetization</h3>
                    <span>Gain insights and strategies to effectively monetize your social media platforms through affiliate marketing and network opportunities.</span>    
                </div>
                <!--End Single Partner Logo Box-->
                <!--Start Single Partner Logo Box-->
                <div class="single-partner-logo-box" style="min-height: 250px; width: 250px; text-align: center;">
                    <a href="#"><img src="assets/images/brand/brand-1-2.jpg" style="height: 200px; width: 200px" alt="Online Games"></a>
                    <h3 style="font-weight: bold;">Interactive Online Games</h3>
                    <span>Enjoy engaging games and unlock exciting prizes as you advance through levels.</span>
                </div>
                <!--End Single Partner Logo Box-->
                <!--Start Single Partner Logo Box-->
                <div class="single-partner-logo-box" style="min-height: 250px; width: 250px; text-align: center;">
                    <a href="#"><img src="assets/images/brand/brand-1-3.jpg" style="height: 200px; width: 200px" alt="Marketplace & Trade"></a>
                    <h3 style="font-weight: bold;">Marketplace & Trade</h3>
                    <span>Showcase and sell products to a broad online audience, driving instant engagement and patronage.</span>
                </div>
                <!--End Single Partner Logo Box-->
                <!--Start Single Partner Logo Box-->
                <div class="single-partner-logo-box" style="min-height: 250px; width: 250px; text-align: center;">
                    <a href="#"><img src="assets/images/brand/brand-1-4.jpg" style="height: 200px; width: 200px" alt="Advanced Skills and Training"></a>
                    <h3 style="font-weight: bold;">Advanced Skills and Training</h3>
                    <span>Learn in-demand 21st-century skills from experienced professionals to stay ahead in the digital economy.</span>
                </div>
                <!--End Single Partner Logo Box-->
            </div>
            <div class="notice-area">
              <h3>Marketplace is Open!</h3>
              <p>
                Upload your goods now and connect with instant buyers. Don't miss this opportunity to grow your sales!
              </p>
              <a href="/marketplace" class="btn-upload">Go to Marketplace</a>
            </div>
        </div>
    </div>
    
</section>
  <script>
    document.addEventListener("DOMContentLoaded", () => {

   // Copy referral link to clipboard
  document.getElementById('copy-btn').addEventListener('click', () => {
    const referralLink = document.getElementById('referral-link');
    referralLink.select();
    referralLink.setSelectionRange(0, 99999); // For mobile devices
    navigator.clipboard.writeText(referralLink.value)
      .then(() => showTemporaryMessage("Referral link copied to clipboard!", "success"))
      .catch((err) => console.error("Failed to copy:", err));
  });

 // Toggle sidebar visibility
 const toggleButton = document.getElementById("toggle-btn");
  const sidebar = document.querySelector(".sidebar");
  toggleButton.addEventListener("click", () => sidebar.classList.toggle("show"));

  // Periodic session status check
  setInterval(async () => {
    try {
      const response = await fetch(`${BASE_URL}/check-session`);
      if (!response.ok) return;
      const data = await response.json();
      if (!data.active) {
        showTemporaryMessage("Your session has expired. Please sign in again.", "warning");
        window.location.href = "/index.html";
      }
    } catch (error) {
      console.error("Session check error:", error);
    }
  }, 86400000); // Daily check

 // Fetch and display all-time earnings
 const allTimeEarningsElement = document.getElementById("all-time-earnings");
  fetch(`${BASE_URL}/all-time-earnings`)
    .then(response => response.ok ? response.json() : Promise.reject())
    .then(data => allTimeEarningsElement.textContent = `$${parseFloat(data.totalEarnings).toFixed(2)}`)
    .catch(() => allTimeEarningsElement.textContent = "$0");

 // Fetch and populate dashboard data
 async function loadDashboardData() {
    try {
      const response = await fetch(`${BASE_URL}/dashboard`);
      if (!response.ok) throw new Error("Failed to load dashboard data.");
      const data = await response.json();
      document.getElementById("active-package").textContent = data.activePackage;
      document.getElementById("gsp-cash").textContent = `$${data.gspCash.toFixed(2)}`;
      document.getElementById("sale-commission").textContent = `$${data.saleCommission.toFixed(2)}`;
      document.getElementById("todays-referrals").textContent = data.todaysReferrals;
      document.getElementById("total-referrals").textContent = data.totalReferrals;
    } catch (error) {
      console.error(error);
    }
  }
  loadDashboardData();

  fetch(`${BASE_URL}/generate-referral-link`)
    .then(res => res.ok ? res.json() : Promise.reject())
    .then(data => document.getElementById("referral-link").value = data.referralLink)
    .catch(console.error);

/* const resetLocalStorage = () => {
      // Clear specific keys or all localStorage
      localStorage.removeItem("clickedTaskDate");
      localStorage.removeItem("clickedTaskIndex");
      localStorage.removeItem("rewardAmount");
  
      console.log("LocalStorage reset completed!");
    };
  
    // Call resetLocalStorage here to ensure a fresh start
    resetLocalStorage(); */


  const choose = document.getElementById("choose");
  const claimBtn = document.getElementById("claim-btn");
  const message = document.getElementById("task-message");
  const gspCashEl = document.getElementById("gsp-cash");

  let rewardAmount = 0;

  const today = new Date().toLocaleDateString();
  const savedTaskDate = localStorage.getItem("clickedTaskDate");

  // Restore state if task was clicked today
  if (savedTaskDate === today) {
    const savedTaskIndex = localStorage.getItem("clickedTaskIndex");
    const clickedTask = document.querySelector(`.task[data-index="${savedTaskIndex}"]`);
    clickedTask.innerHTML = `<div class="inner">
                              <div class="front"></div>
                              <div class="back">$${localStorage.getItem("rewardAmount")}</div>
                            </div>`;
    clickedTask.classList.add("flipped");
    claimBtn.disabled = true;
    rewardAmount = parseFloat(localStorage.getItem("rewardAmount"));
    message.textContent = "You have already completed today's task!";
  }

  // Handle task click
  choose.addEventListener("click", () => {
    if (localStorage.getItem("clickedTaskDate") === today) {
      message.textContent = "You can only click one task per day!";
      return;
    }

    // Generate random reward between $0.5 and $1.5
    rewardAmount = parseFloat((Math.random() * (1.5 - 0.5) + 0.5).toFixed(2));

    // Flip the task and display reward
    choose.innerHTML = `<div class="inner">
                          <div class="front"></div>
                          <div class="back">$${rewardAmount}</div>
                        </div>`;
    choose.classList.add("flipped");

    // Disable further clicks
    choose.style.pointerEvents = "none";

    // Enable claim button
    claimBtn.disabled = false;

    // Save state in local storage
    localStorage.setItem("clickedTaskIndex", choose.getAttribute("data-index"));
    localStorage.setItem("clickedTaskDate", today);
    localStorage.setItem("rewardAmount", rewardAmount);

    // Update message
    message.textContent = `You won $${rewardAmount}! Click "Claim Reward" to add to your GSP Cash.`;

  // Claim reward
  claimBtn.addEventListener("click", async () => {
    try {
      const response = await fetch(`${BASE_URL}/claim-daily-task`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ rewardAmount }),
      });

      if (!response.ok) {
        throw new Error("Failed to claim reward.");
      }

      const data = await response.json();
      const newGspCash = data.gspCash;

      // Update the GSP Cash display
      gspCashEl.textContent = `$${newGspCash.toFixed(2)}`;

      claimBtn.disabled = true;
      message.textContent = "Reward claimed! Redirecting you...";

      // Redirect to social media
      setTimeout(() => {
        window.location.href = "https://chat.whatsapp.com/EqPaCBNtoE8JL7ii52EUAe"; // Update to your desired URL
      }, 10000);
    } catch (error) {
      console.error("Error claiming reward:", error);
      showTemporaryMessage("Failed to claim reward. Please try again.", "warning");
    }
  });
});


  fetch(`${BASE_URL}/dashboard-data`)
    .then((response) => {
      if (!response.ok) throw new Error("Failed to fetch dashboard data.");
      return response.json();
    })
    .then((data) => {
      const { referralCount, dailyEarning, allTimeEarning, weeks } = data;

      const chartData = {
        labels: weeks,
        datasets: [
          {
            label: "Referrals",
            data: referralCount,
            borderColor: "rgba(75, 192, 192, 1)",
            backgroundColor: "rgba(75, 192, 192, 0.2)",
            tension: 0.4,
          },
          {
            label: "Daily Earnings ($)",
            data: dailyEarning,
            borderColor: "rgba(255, 159, 64, 1)",
            backgroundColor: "rgba(255, 159, 64, 0.2)",
            tension: 0.4,
          },
          {
            label: "All-Time Earnings ($)",
            data: allTimeEarning,
            borderColor: "rgba(54, 162, 235, 1)",
            backgroundColor: "rgba(54, 162, 235, 0.2)",
            tension: 0.4,
          },
        ],
      };

      const config = {
        type: "line",
        data: chartData,
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: "top",
            },
          },
          scales: {
            x: {
              title: {
                display: true,
                text: "Weeks",
              },
            },
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: "Values",
              },
            },
          },
        },
      };

      const ctx = document.getElementById("combinedChart").getContext("2d");
      new Chart(ctx, config);
    })
    .catch((err) => {
      console.error("Error loading chart data:", err);
    });
});

function showTemporaryMessage(message, type) { let messageContainer = document.getElementById("message-container");if (!messageContainer) {messageContainer = document.createElement("div");messageContainer.id = "message-container"; messageContainer.style.position = "fixed"; messageContainer.style.top = "10px"; messageContainer.style.right = "10px"; messageContainer.style.zIndex = "1000";document.body.appendChild(messageContainer);}const messageElement = document.createElement("div");messageElement.textContent = message;messageElement.style.padding = "10px 20px";messageElement.style.margin = "5px";messageElement.style.borderRadius = "5px";messageElement.style.color = "white";messageElement.style.fontWeight = "bold";messageElement.style.opacity = "1";messageElement.style.transition = "opacity 0.5s ease"; if (type === "success") { messageElement.style.backgroundColor = "#4caf50"; } else if (type === "warning") { messageElement.style.backgroundColor = "#f44336";   } messageContainer.appendChild(messageElement);setTimeout(() => { messageElement.style.opacity = "0"; setTimeout(() => {    messageContainer.removeChild(messageElement); }, 500);}, 4000);}

  </script>
  <script src="assets/vendors/jquery/jquery-3.6.0.min.js"></script>
    <script src="assets/vendors/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendors/bxslider/jquery.bxslider.min.js"></script>
    <script src="assets/vendors/circleType/jquery.circleType.js"></script>
    <script src="assets/vendors/circleType/jquery.lettering.min.js"></script>
    <script src="assets/vendors/isotope/isotope.js"></script>
    <script src="assets/vendors/jquery-ajaxchimp/jquery.ajaxchimp.min.js"></script>
    <script src="assets/vendors/jquery-appear/jquery.appear.min.js"></script>
    <script src="assets/vendors/jquery-magnific-popup/jquery.magnific-popup.min.js"></script>
    <script src="assets/vendors/jquery-ui/jquery-ui.js"></script>
    <script src="assets/vendors/jquery-validate/jquery.validate.min.js"></script>
    <script src="assets/vendors/nice-select/jquery.nice-select.min.js"></script>
    <script src="assets/vendors/odometer/odometer.min.js"></script>
    <script src="assets/vendors/owl-carousel/owl.carousel.min.js"></script>
    <script src="assets/vendors/swiper/swiper.min.js"></script>
    <script src="assets/vendors/vegas/vegas.min.js"></script>
    <script src="assets/vendors/wnumb/wNumb.min.js"></script>
    <script src="assets/vendors/wow/wow.js"></script>
    <script src="assets/vendors/extra-scripts/jquery.paroller.min.js"></script>
    <script src="assets/vendors/language-switcher/jquery.polyglot.language.switcher.js"></script>
    <script src="assets/js/custom.js"></script>
</body>
</html>
